#!/usr/bin/env bash

# Build the ultimate_turbo_modal JavaScript package
echo "Building ultimate_turbo_modal JavaScript package..."
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DEMO_APP_DIR="$SCRIPT_DIR/.."

# Symlink flavor files from gem to demo app
echo "Symlinking flavor files to demo app..."
FLAVOR_SOURCE_DIR="$DEMO_APP_DIR/../lib/generators/ultimate_turbo_modal/templates/flavors"
FLAVOR_DEST_DIR="$DEMO_APP_DIR/config/initializers"

# Symlink each flavor file with the appropriate naming (force overwrite)
ln -sf "$FLAVOR_SOURCE_DIR/tailwind.rb" "$FLAVOR_DEST_DIR/ultimate_turbo_modal_tailwind.rb"
ln -sf "$FLAVOR_SOURCE_DIR/tailwind3.rb" "$FLAVOR_DEST_DIR/ultimate_turbo_modal_tailwind3.rb"
ln -sf "$FLAVOR_SOURCE_DIR/vanilla.rb" "$FLAVOR_DEST_DIR/ultimate_turbo_modal_vanilla.rb"
ln -sf "$FLAVOR_SOURCE_DIR/custom.rb" "$FLAVOR_DEST_DIR/ultimate_turbo_modal_custom.rb"

(cd "$DEMO_APP_DIR" && bundle install)

# Start the development servers
if command -v overmind &> /dev/null; then
  overmind start -f $DEMO_APP_DIR/Procfile.dev "$@"
else
  foreman start -f $DEMO_APP_DIR/Procfile.dev "$@"
fi
